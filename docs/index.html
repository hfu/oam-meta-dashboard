<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OAM Meta Dashboard</title>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const l={regionSelect:document.getElementById("regionSelect"),sortSelect:document.getElementById("sortSelect"),loading:document.getElementById("loading"),error:document.getElementById("error"),cardGrid:document.getElementById("cardGrid"),assetCount:document.getElementById("assetCount"),totalSize:document.getElementById("totalSize")},m={assets:[],isLoading:!1,requestId:0,currentDataset:"sierra-leone"},D=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"2-digit"});function z(e){try{return new URL(e),!0}catch{return!1}}function F(e){return e==="global"?"./data-global-1gb.json":"./data-sierra-leone.json"}async function I(e){const t=F(e),n=await fetch(t,{cache:"no-store"});if(!n.ok)throw new Error(`Snapshot not found: ${n.status}`);return await n.json()}function U(e){if(!Number.isFinite(e)||e<=0)return"N/A";const t=["B","KB","MB","GB","TB"];let n=e,o=0;for(;n>=1024&&o<t.length-1;)n/=1024,o+=1;return`${n.toFixed(2)} ${t[o]}`}function A(e){if(!e||typeof e!="string")return"";if(e.startsWith("s3://")){const n=e.replace("s3://","").split("/"),o=n.shift(),r=n.join("/");if(o&&r)return`https://${o}.s3.amazonaws.com/${r}`}return e}function y(e){if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t}function _(e){const t=y(e);return t?D.format(t):"Unknown"}function $(e){if(!e&&e!==0)return"N/A";const t=Array.isArray(e)?Number(e[0]):typeof e=="number"?e:Number(e);return!Number.isFinite(t)||t<=0?"N/A":`${Math.round(t*100)} cm`}function s(e,t){for(const n of t)if(e&&n in e&&e[n]!==null&&e[n]!=="")return e[n];return null}function q(e){const t=(e==null?void 0:e.properties)||{},n=s(e,["title","name"])||s(t,["title","name"]),o=s(e,["acquisition_start"])||s(t,["acquisition_start","datetime"]),r=s(e,["platform"])||s(t,["platform","platform_name"]),i=s(e,["provider"])||s(t,["provider"]),u=s(e,["resolution"])||s(t,["gsd","resolution"]),a=s(e,["file_size"])||s(t,["file_size"]),c=s(e,["uuid"])||s(t,["uuid"]),d=s(e,["s3_path","url","download_url"])||s(t,["s3_path","url","download_url"]),p=s(e,["thumbnail","thumbnail_url"])||s(t,["thumbnail","thumbnail_url"]),h=A(d||c||"");return{title:n||"Untitled asset",acquisitionStart:o,platform:r||"Unknown",provider:i||"Unknown",resolution:$(u),fileSizeBytes:typeof a=="number"?a:Number(a),uuid:c||"Unknown",assetUrl:h,thumbnail:p||"",hasKnownSize:Number.isFinite(Number(a))&&Number(a)>0}}function v(e){const t=l.sortSelect.value,n=[...e];return n.sort((o,r)=>{var d,p;if(t.startsWith("date")){const h=(d=y(o.acquisitionStart))==null?void 0:d.getTime(),w=(p=y(r.acquisitionStart))==null?void 0:p.getTime(),S=Number.isFinite(h),L=Number.isFinite(w);if(S!==L)return S?-1:1;const N=h||0,C=w||0;return t==="date-asc"?N-C:C-N}const i=Number.isFinite(o.fileSizeBytes),u=Number.isFinite(r.fileSizeBytes);if(i!==u)return i?-1:1;const a=o.fileSizeBytes||0,c=r.fileSizeBytes||0;return t==="size-asc"?a-c:c-a}),n}function x(e){const t=e.reduce((o,r)=>Number.isFinite(r.fileSizeBytes)?o+r.fileSizeBytes:o,0),n=e.filter(o=>Number.isFinite(o.fileSizeBytes)).length;l.assetCount.textContent=`${e.length}`,l.totalSize.textContent=e.length===0?"-":`${U(t)} (known ${n}/${e.length})`}function f(e,t){const n=document.createElement("div");return n.innerHTML=`${e}: <span>${t}</span>`,n}function T(e){if(l.cardGrid.innerHTML="",!e.length){const t=document.createElement("p");t.textContent="No assets found.",l.cardGrid.appendChild(t);return}for(const t of e){const n=document.createElement("article");if(n.className="card",t.thumbnail&&z(t.thumbnail)){const c=document.createElement("img");c.src=t.thumbnail,c.alt="Asset thumbnail",c.loading="lazy",n.appendChild(c)}const o=document.createElement("div");o.className="card-body";const r=document.createElement("div");r.className="card-title";const i=document.createElement("span");i.textContent=t.title;const u=document.createElement("span");u.className="badge",u.textContent=t.platform,r.appendChild(i),r.appendChild(u),o.appendChild(r);const a=document.createElement("div");if(a.className="card-meta",a.appendChild(f("Date",_(t.acquisitionStart))),a.appendChild(f("Provider",t.provider)),a.appendChild(f("Resolution",t.resolution)),a.appendChild(f("File size",U(t.fileSizeBytes))),t.uuid&&t.uuid!=="Unknown"&&z(t.uuid)){const c=document.createElement("div");c.innerHTML="UUID: ";const d=document.createElement("a");d.href=t.uuid,d.target="_blank",d.rel="noopener noreferrer",d.textContent=t.uuid,c.appendChild(d),a.appendChild(c)}else a.appendChild(f("UUID",t.uuid));o.appendChild(a),n.appendChild(o),l.cardGrid.appendChild(n)}}function b(){const e=v(m.assets);x(e),T(e)}function g(e,t="Loading..."){m.isLoading=e,l.loading.textContent=t,l.loading.style.display=e?"block":"none"}function E(e){l.error.textContent=e,l.error.style.display=e?"block":"none"}async function B(e){const t=++m.requestId;E(""),g(!0,"Loading snapshot...");try{const n=await I(e),o=Array.isArray(n.results)?n.results:[];m.assets=o.map(q),m.currentDataset=e,b(),g(!1)}catch(n){if(t!==m.requestId)return;g(!1),E(n.message||"Failed to load data."),m.assets=[],b()}}function k(){const t=new URLSearchParams(window.location.search).get("dataset")||"sierra-leone";l.regionSelect.value=t,m.currentDataset=t,l.regionSelect.addEventListener("change",n=>{const o=n.target.value;m.currentDataset=o;const r=new URL(window.location);r.searchParams.set("dataset",o),window.history.pushState({},"",r),B(o)}),l.sortSelect.addEventListener("change",b),B(t)}k();</script>
    <style rel="stylesheet" crossorigin>@import"https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=Spectral:wght@400;600&display=swap";:root{color-scheme:light;--bg: #f6f3ef;--bg-accent: #ece6de;--ink: #1f1b16;--muted: #655b52;--card: #ffffff;--line: #e2d7cc;--shadow: 0 12px 30px rgba(45, 35, 25, .12);--accent: #d16c35}*{box-sizing:border-box}body{margin:0;background:radial-gradient(circle at top,#fff9f2 0%,var(--bg) 55%),linear-gradient(120deg,var(--bg) 0%,var(--bg-accent) 100%);color:var(--ink);font-family:Space Grotesk,sans-serif}.page{max-width:1100px;margin:0 auto;padding:32px 20px 64px}.header{display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:space-between;gap:16px;margin-bottom:24px}.header-inner h1{font-family:Spectral,serif;font-size:clamp(28px,4vw,44px);margin:8px 0 6px}.eyebrow{text-transform:uppercase;letter-spacing:.22em;font-size:12px;color:var(--muted);margin:0}.subtitle{margin:0;color:var(--muted);max-width:520px}.subtitle-note{margin:10px 0 0;color:var(--muted);font-size:12px;letter-spacing:.08em;text-transform:uppercase}.readme-link{margin-top:16px;display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:999px;border:1px solid var(--line);color:var(--ink);text-decoration:none;font-weight:600;background:#fff;box-shadow:0 10px 20px #2d231914;transition:transform .2s ease,box-shadow .2s ease}.readme-link:hover{transform:translateY(-1px);box-shadow:0 16px 30px #2d23191f}.settings{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:var(--shadow);margin-bottom:20px;transition:max-height .35s ease,opacity .25s ease;overflow:hidden}.settings.is-collapsed{max-height:0;opacity:0;padding:0 20px;border:none;margin-bottom:12px}.url-form{display:grid;gap:12px}.url-form label{font-weight:600}.url-row{display:flex;flex-direction:column;gap:12px}.url-row input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--line);font-size:14px}.hint{margin:0;font-size:12px;color:var(--muted)}.controls{display:flex;flex-direction:column;gap:16px;margin-bottom:20px}.stats{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;background:var(--card);border-radius:16px;border:1px solid var(--line);padding:16px;box-shadow:var(--shadow)}.stat-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.12em}.stat-value{display:block;font-size:20px;font-weight:600;margin-top:6px}.sort{display:grid;gap:6px}.sort select{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff}.regions{display:grid;gap:6px}.regions select{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff}.status{min-height:32px;margin-bottom:12px}.loading{color:var(--muted);font-size:14px}.error{color:#9a2f20;font-weight:500}.grid{display:grid;grid-template-columns:1fr;gap:18px}.card{background:var(--card);border-radius:16px;border:1px solid var(--line);box-shadow:var(--shadow);overflow:hidden;display:grid;grid-template-columns:1fr;animation:fade-up .4s ease forwards}.card img{width:100%;height:180px;object-fit:cover;background:#f1e7dc}.card-body{padding:16px;display:grid;gap:10px}.card-title{font-weight:600;font-size:16px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}.card-title span:first-child{flex:1 1 220px;min-width:0;word-break:break-word}.card-meta{display:grid;gap:6px;font-size:13px;color:var(--muted)}.card-meta a{color:var(--ink);font-weight:500;text-decoration:underline;word-break:break-all}.card-meta span{color:var(--ink);font-weight:500}.card-links{display:flex;flex-wrap:wrap;gap:8px;align-items:center}.card-links a{color:var(--accent);text-decoration:none;font-weight:600;font-size:13px}.badge{display:inline-flex;align-items:center;justify-content:center;padding:2px 8px;border-radius:6px;border:1px solid var(--line);font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}button{border:none;border-radius:999px;padding:10px 18px;font-family:inherit;font-weight:600;cursor:pointer}button.primary{background:var(--accent);color:#fff}button.ghost{background:transparent;border:1px solid var(--line);color:var(--ink)}@keyframes fade-up{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@media (min-width: 720px){.url-row{flex-direction:row}.controls{flex-direction:row;align-items:center;justify-content:space-between}.sort{max-width:220px}.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width: 1024px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}</style>
  </head>
  <body>
    <div class="page">
      <header class="header">
        <div class="header-inner">
          <p class="eyebrow">OpenAerialMap</p>
          <h1>Aerial Imagery Asset Dashboard</h1>
          <p class="subtitle">
            Quick view of aerial imagery metadata by region.
          </p>
          <p class="subtitle-note">Snapshot loaded at build time.</p>
          <a
            class="readme-link"
            href="https://github.com/hfu/oam-meta-dashboard/blob/main/README.md"
            target="_blank"
            rel="noopener noreferrer"
          >
            Read the project README
          </a>
        </div>
      </header>

      <section class="controls">
        <div class="regions">
          <label for="regionSelect">Dataset</label>
          <select id="regionSelect" name="regionSelect">
            <option value="sierra-leone">Sierra Leone</option>
            <option value="global">Global (â‰¥1GB)</option>
          </select>
        </div>
        <div class="stats">
          <div>
            <span class="stat-label">Assets</span>
            <span id="assetCount" class="stat-value">-</span>
          </div>
          <div>
            <span class="stat-label">Total size</span>
            <span id="totalSize" class="stat-value">-</span>
          </div>
        </div>
        <div class="sort">
          <label for="sortSelect">Sort</label>
          <select id="sortSelect" name="sortSelect">
            <option value="date-desc">Date (newest)</option>
            <option value="date-asc">Date (oldest)</option>
            <option value="size-desc">Size (largest)</option>
            <option value="size-asc">Size (smallest)</option>
          </select>
        </div>
      </section>

      <section class="status">
        <div id="loading" class="loading" aria-live="polite">Loading...</div>
        <div id="error" class="error" role="alert"></div>
      </section>

      <main>
        <div id="cardGrid" class="grid"></div>
      </main>
    </div>

  </body>
</html>
